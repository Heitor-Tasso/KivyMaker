#: import hex kivy.utils.get_color_from_hex
#: import Clock kivy.clock.Clock

#: import KVIcons KVUtils.KVIcons
#: import KVPhone KVUtils.KVPhone
#: import KVButtonEffect KVuix.KVButtons.KVButtonEffect
#: import KVButtonIcon KVuix.KVIcon.KVButtonIcon
#: import KVToggleButtonIcon KVuix.KVIcon.KVToggleButtonIcon
#: import KVAnchorIcon KVuix.KVIcon.KVAnchorIcon
#: import KVIconInput KVuix.KVInputs.KVIconInput
#: import PhonesDropDown KVuix.KVDropdown.PhonesDropDown

<TollBarTop@BoxLayout>:
    size_hint_y:None
    height:'55dp'
    canvas:
        Color:
            rgba:hex('#282a36')
        Rectangle:
            size:self.size
            pos:self.pos

<Init_screen>:
    orientation:'vertical'
    orange_sunset: hex('#ff5555')

    ScreenManager:
        id:tl
        Screen:
            name:'config'
            BoxLayout:
                orientation:'vertical'
                TollBarTop:
                    KVAnchorIcon:
                        KVButtonIcon:
                            source:KVIcons('exit')
                            on_release:app.stop(app)
                    Label:
                        text:'Configurando'
                        font_size: '20sp'
                    KVAnchorIcon:
                        KVButtonIcon:
                            source:KVIcons('help')

                AnchorLayout:
                    pad:root.width/5
                    padding:[self.pad, 70, self.pad, 70] if root.width > dp(500) else [10, 70, 10, 70]
                    canvas:
                        Color:
                            rgba:hex('#44475a')
                        Rectangle:
                            size:self.size
                            pos:self.pos
                    BoxLayout:
                        orientation:'vertical'
                        canvas:
                            Color:
                                rgba:hex('#6272a4')
                            RoundedRectangle:
                                radius: [20, 20, 20, 20]
                                size:self.size
                                pos:self.pos
                        Widget:
                        AnchorLayout:
                            anchor_x:'center'
                            size_hint_y:None
                            height:'90dp'
                            KVIconInput:
                                id:input_file
                                size_hint_x:0.85

                                label_defaut_color:[208, 208, 208, 1]
                                text_input_color:[0, 0, 0, 1]
                                line_color:[0, 0, 0, 1]
                                background_color:[1, 1, 1, 0.75]

                                label_text:'Open File'
                                icon_right_pos_sources:
                                    [KVIcons('create'), KVIcons('path')]
                                icon_right_type:'button'

                                on_icon_right_release:root.search_path()
                                on_input_press:
                                    self.text_input.text = 'Enter local file' if \
                                    self.text_input.text == '' else self.text_input.text
                                on_input_text:
                                    self.text_input.text = '' if \
                                    self.text_input.text == 'Enter local file' else self.text_input.text
                        AnchorLayout:
                            anchor_x:'center'
                            size_hint_y:None
                            height:'90dp'
                            KVIconInput:
                                id:input_create
                                size_hint_x:0.85

                                label_defaut_color:[208,208,208,1]
                                text_input_color:[0,0,0,1]
                                line_color:[0,0,0,1]
                                icon_right_color:[0,0,0,1]
                                icon_right_color_pos:[10,0,0,1]
                                background_color:[1,1,1,.75]

                                icon_right_source:KVIcons('add_white')
                                icon_right_type:'button'
                                label_text:'Create File'

                                on_icon_right_release:
                                    root.path_file_created(self.text_input.text, True)
                                on_input_press:
                                    self.text_input.text = 'Enter name file' if \
                                    self.text_input.text == '' else self.text_input.text
                                on_input_text:
                                    self.text_input.text = '' if \
                                    self.text_input.text == 'Enter name file' else self.text_input.text
                        Widget:
        Screen:
            name:'tela_kv'
            BoxLayout:
                orientation:'vertical'
                id:boxkv
                canvas:
                    Color:
                        rgba:hex('#44475a')
                    Rectangle:
                        size:self.size
                        pos:self.pos
                TollBarTop:
                    anc_width:'50dp' if self.width < dp(450) else '70dp'
                    KVAnchorIcon:
                        width: self.parent.anc_width
                        KVButtonIcon:
                            source:KVIcons('back')
                            on_release:root.volta()
                    Widget:
                    KVAnchorIcon:
                        width: self.parent.anc_width
                        KVButtonIcon:
                            icon_color:root.orange_sunset
                            source:KVIcons('editor')
                            on_press:
                                root.create_editor() if root.editors == [] else \
                                root.hide_editor(root.index_editor-1)
                    KVAnchorIcon:
                        width: self.parent.anc_width
                        KVToggleButtonIcon:
                            icon_color:root.orange_sunset
                            source:KVIcons('repetition')
                            id:bt_toggle
                            on_state: root.reload(self.state)
                    KVAnchorIcon:
                        width: self.parent.anc_width
                        KVToggleButtonIcon:
                            icon_color:root.orange_sunset
                            source:KVIcons('terminal2')
                            on_state:root.update_debug(self.state)
                            id:btn_debug
                    KVAnchorIcon:
                        width: self.parent.anc_width
                        KVButtonIcon:
                            icon_color:[1, 1, 1, 1]
                            source:KVIcons('reload1')
                            on_press: root.allow_loading()
                    Widget:
                    KVAnchorIcon:
                        width: self.parent.anc_width
                        KVButtonIcon:
                            source:KVIcons('exit')
                            on_release:app.stop(app)
                BoxLayout:
                    id:boxCode
                    Button:
                        size_hint_x:None
                        width:'30dp'
                        x_touch: 0
                        can:False
                        on_touch_down:
                            self.x_touch = args[1].pos[0]
                            self.can = False if not self.collide_point(*args[1].pos) else True
                        on_touch_move:
                            self.x_touch = root.splitter_editor(self.x_touch, args[1].pos[0], telinhas)\
                            if self.can else self.x_touch

                    ScreenManager:
                        id:telinhas
                        size_hint_x:0.5
                        Screen:
                            name:'ScreenWidget'
                            BoxLayout:
                                orientation: 'vertical'
                                GridLayout:
                                    canvas.before:
                                        Color:
                                            rgba: (0.12, 0.12, 0.12, 1)
                                        Rectangle:
                                            size: self.size
                                            pos: self.pos
                                    rows: 1
                                    id: tab_manager
                                    size_hint_y: None
                                    height: '45dp'
                                    KVAnchorIcon:
                                        KVButtonIcon:
                                            source:KVIcons('zoom-out')
                                            func: None
                                            on_press:
                                                self.func = root.start_zoom_phone(dp(10), phone)
                                            on_release:
                                                root.stop_zoom_phone(self.func)
                                            size:'30dp', '30dp'
                                    KVAnchorIcon:
                                        KVButtonIcon:
                                            source:KVIcons('zoom-in')
                                            func: None
                                            on_press:
                                                self.func = root.start_zoom_phone(dp(-10), phone)
                                            on_release:
                                                root.stop_zoom_phone(self.func)
                                            size:'30dp', '30dp'
                                    KVAnchorIcon:
                                        ToggleButton:
                                            canvas:
                                                Clear
                                                PushMatrix
                                                Color:
                                                    rgba:[1, 1, 1, 1]
                                                Rotate:
                                                    angle:self.angle
                                                    origin: self.center_x, self.center_y
                                                Rectangle:
                                                    size:self.size
                                                    pos:self.pos
                                                    source:KVIcons('iphone-mobile')
                                                PopMatrix
                                            size_hint:None, None
                                            size:'30dp', '30dp'
                                            background_color:[0, 0, 0, 0]
                                            id:orient
                                            angle:0
                                            on_state:
                                                self.angle = 90 if self.state == 'down' else 0
                                    KVAnchorIcon:
                                        KVButtonIcon:
                                            source: KVIcons('three-dots')
                                            size:'30dp', '30dp'
                                            can_open: True
                                            drop: None
                                            on_press:
                                                PhonesDropDown(root.phones, root.props_phones).open(self)
                                    KVAnchorIcon:
                                        KVToggleButtonIcon:
                                            state_sources:
                                                [KVIcons('change-screen'), KVIcons('change-screen-white')]
                                            on_state:
                                                img_phone.change_screen = False if self.state == 'down' else True
                                            size:'30dp', '30dp'
                                AnchorLayout:
                                    padding:[dp(15), dp(15), dp(15), dp(15)]
                                    Image:
                                        id:img_phone
                                        canvas:
                                            Clear
                                            Rotate:
                                                angle: orient.angle
                                                origin: self.center_x, self.center_y
                                        canvas.after:
                                            Color:
                                                rgba: [1, 1, 1, 1]
                                            Rectangle:
                                                size: self.size
                                                pos: self.pos
                                                texture:self.texture
                                        on_size:
                                            root.change_screens()
                                        source:KVPhone('samsung-s10')
                                        prop:root.prop_phone or {'scale':1, 'height':1, 'x':0, 'y':0}
                                        change_screen: True
                                        allow_strech: True
                                        keep_ratio: False
                                        mipmap: True
                                        FloatLayout:
                                            size_hint:None, None
                                            size: (0, 0)
                                            BoxStencil:
                                                size:
                                                    (phone.width*sct.scale, phone.height*sct.scale)
                                                x:
                                                    img_phone.x + (img_phone.width/2) - \
                                                    (self.width/2) + img_phone.prop['x']
                                                y:
                                                    img_phone.y + (img_phone.height/2) - \
                                                    (self.height/2) + img_phone.prop['y']
                                                Scatter:
                                                    do_rotation: False
                                                    do_scale: False
                                                    do_translation: False
                                                    do_collide_after_children: True
                                                    auto_bring_to_front: False
                                                    scale:
                                                        (img_phone.width*img_phone.prop['scale']) / phone.width
                                                    id:sct
                                                    AnchorLayout:
                                                        id:phone
                                                        size_hint:None, None
                                                        width: dp(400)
                                                        height:
                                                            (img_phone.height**2) * img_phone.prop['height'] / \
                                                            (img_phone.height*sct.scale + 1/100)
<BoxStencil@BoxLayout+StencilView>:
    size_hint:None, None

<Debug>:
    orientation:'vertical'
    size_hint_y:None
    height:'200dp'
    Label:
        text:'Debug'
        size_hint_y:None
        height:'40dp'
        font_size: '20sp'
        bold:True
        canvas.before:
            Color:
                rgba:hex('#44475a')
            Rectangle:
                size:self.size
                pos:self.pos
    TextInput:
        id: text_debug
        #font_size:'16dp'
        # background_color:hex('#282a36')
